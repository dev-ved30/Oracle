

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>oracle.custom_datasets.BTS module &mdash; oracle 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=29a6c3e3"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            oracle
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">oracle</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">oracle.custom_datasets.BTS module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/source/oracle.custom_datasets.BTS.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-oracle.custom_datasets.BTS">
<span id="oracle-custom-datasets-bts-module"></span><h1>oracle.custom_datasets.BTS module<a class="headerlink" href="#module-oracle.custom_datasets.BTS" title="Link to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oracle.custom_datasets.BTS.</span></span><span class="sig-name descname"><span class="pre">BTS_LC_Dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parquet_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mapper</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_n_per_class</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_postage_stamps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_lc_plots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">over_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">excluded_classes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></p>
<p>A custom PyTorch Dataset class for handling BTS light curve data stored in a parquet file.</p>
<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.clean_up_dataset">
<span class="sig-name descname"><span class="pre">clean_up_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.clean_up_dataset" title="Link to this definition"></a></dt>
<dd><dl class="simple">
<dt>Clean up the dataset by executing a series of transformations:</dt><dd><ul class="simple">
<li><p>Adjusts the observation times by subtracting the time of the first observation from each ‘jd’ entry.</p></li>
<li><p>Converts band labels in the ‘fid’ column to their corresponding mean wavelengths based on a predefined mapping.</p></li>
<li><p>Maps BTS sample explorer classes from the ‘bts_class’ column to astrophysical classes using a provided mapper.</p></li>
<li><dl class="simple">
<dt>Computes new WISE color indices:</dt><dd><ul>
<li><p>‘W1_minus_W3’ as the difference between ‘W1mag’ and ‘W3mag’.</p></li>
<li><p>‘W2_minus_W3’ as the difference between ‘W2mag’ and ‘W3mag’.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Transforms celestial coordinates:</dt><dd><ul>
<li><p>Converts the right ascension (‘ra’) and declination (‘dec’) into galactic longitude (‘l’).</p></li>
<li><p>Converts the right ascension (‘ra’) and declination (‘dec’) into galactic latitude (‘b’) using the SkyCoord library.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
</dd>
</dl>
<p>Prints status messages at each step to indicate progress.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.convert_mags_to_flux">
<span class="sig-name descname"><span class="pre">convert_mags_to_flux</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.convert_mags_to_flux" title="Link to this definition"></a></dt>
<dd><p>Converts magnitude measurements to flux values and computes the corresponding flux uncertainties.
The method processes the dataframe stored in <cite>self.parquet_df</cite> by adding two new columns:</p>
<blockquote>
<div><ul class="simple">
<li><dl class="simple">
<dt>“flux”: Computed from the “magpsf” column using the relation: flux = F0 * 10^(-0.4 * magpsf)</dt><dd><p>where F0 is set to 3631.0 * 1e6 micro-Janskys (µJy).</p>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>“flux_err”: Calculated via error propagation using both “magpsf” and “sigmapsf” columns:</dt><dd><p>flux_err = (0.4 * ln(10)) * F0 * 10^(-0.4 * magpsf) * sigmapsf</p>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Element-wise operations are employed to map the magnitude values (and their uncertainties)to corresponding flux values across the dataframe.</p></li>
<li><p>The resulting “flux” and “flux_err” columns are lists of floats.</p></li>
</ul>
</div>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None. The dataframe <cite>self.parquet_df</cite> is modified in place.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.exclude_classes">
<span class="sig-name descname"><span class="pre">exclude_classes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.exclude_classes" title="Link to this definition"></a></dt>
<dd><p>Exclude specified classes from the dataset.
This method filters the dataset contained in <cite>self.parquet_df</cite> by removing any rows whose
‘class’ value is present in the <cite>self.excluded_classes</cite> list.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Assumes that the dataframe <cite>self.parquet_df</cite> has a column named ‘class’.</p></li>
<li><p>The method leverages the filtering function of the dataframe library (e.g., Polars).</p></li>
</ul>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.get_all_labels">
<span class="sig-name descname"><span class="pre">get_all_labels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.get_all_labels" title="Link to this definition"></a></dt>
<dd><p>Retrieves all labels from the parquet dataframe’s ‘class’ column.
:returns: A list of labels extracted from the ‘class’ column.
:rtype: list</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.get_lc_plots">
<span class="sig-name descname"><span class="pre">get_lc_plots</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_ts</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.get_lc_plots" title="Link to this definition"></a></dt>
<dd><p>Generates a light curve plot image from time series data and returns it as a Torch tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x_ts</strong> (<em>numpy.ndarray</em>) – 2D array where each row corresponds to a time step and columns represent
various features including ‘jd’ (Julian Date), ‘flux’ (observed flux),
‘flux_err’ (flux error), and ‘fid’ (filter identifier). The feature indices
are determined using the global variable time_dependent_feature_list.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tensor representing the RGB image of the generated light curve plot
with shape (3, H, W), where H and W are the height and width of the image in pixels.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The function uses matplotlib to create the plot and PIL to handle image conversion.</p></li>
<li><p>It iterates over wavelengths defined in the global dictionary ZTF_wavelength_to_color, plotting
error bars for each wavelength filtered by the ‘fid’ feature.</p></li>
<li><p>The output image is saved to an in-memory buffer at 100 dpi, then converted from a PIL Image to a
NumPy array and finally to a Torch tensor.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>[TODO] This function can be optimized further to avoid using matplotlib and PIL altogether. Its really slow right now…</p></li>
</ul>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.get_postage_stamp">
<span class="sig-name descname"><span class="pre">get_postage_stamp</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">examples</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.get_postage_stamp" title="Link to this definition"></a></dt>
<dd><p>Generates a postage stamp image tensor for the provided source.
This function iterates over a set of predefined filters (ztf_filters) and extracts
the corresponding reference images from the ‘examples’ dictionary. Each extracted image
is stored in a canvas array, which is then scaled from a range [0, 1] to [0, 255]
and converted into a PyTorch tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>examples</strong> (<em>dict</em>) – A dictionary containing image data corresponding to each filter reference,
with keys formatted as ‘{filter}_reference’.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tensor of shape (len(ztf_filters), img_length, img_length) representing the
postage stamp images, with pixel values scaled to the range [0, 255].</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.get_postage_stamp_plot">
<span class="sig-name descname"><span class="pre">get_postage_stamp_plot</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">examples</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.get_postage_stamp_plot" title="Link to this definition"></a></dt>
<dd><p>Generates a postage stamp plot from the given image examples and returns it as a PyTorch tensor.
The function assembles a canvas by arranging image sections corresponding to various filters (defined in the global
ztf_filters) side-by-side. Each section is populated using the “{filter}_reference” key from the provided examples
dictionary. The canvas is then plotted using matplotlib, without axis ticks or spines, and saved into a PNG image
buffer. This image is subsequently loaded via PIL, converted to a NumPy array with channel-first ordering, and finally
wrapped into a PyTorch tensor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>examples</strong> (<em>dict</em>) – A dictionary containing image data. For every filter in the global variable ztf_filters, the key
corresponding to the image is expected to be formatted as “{filter}_reference”.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The resulting image as a PyTorch tensor with shape (C, H, W), where C is the number of color channels,
and H and W correspond to the height and width of the assembled image, respectively.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<ul class="simple">
<li><p>[TODO] This function can be optimized further to avoid using matplotlib and PIL altogether. Its really slow right now…</p></li>
</ul>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.limit_max_samples_per_class">
<span class="sig-name descname"><span class="pre">limit_max_samples_per_class</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.limit_max_samples_per_class" title="Link to this definition"></a></dt>
<dd><p>Limits the number of samples for each class in the dataset to a maximum specified by self.max_n_per_class.
This method performs the following steps:</p>
<blockquote>
<div><ul class="simple">
<li><p>Prints a message indicating that the dataset is being limited to self.max_n_per_class samples per class.</p></li>
<li><p>Retrieves the unique class labels from the ‘class’ column of self.parquet_df.</p></li>
<li><p>For each unique class, it filters the dataframe to include only entries belonging to that class and slices the result to retain only the first self.max_n_per_class rows.</p></li>
<li><p>Collects the limited dataframes for each class and concatenates them back into a single dataframe.</p></li>
<li><p>Prints the number of samples retained for each class.</p></li>
<li><p>Updates self.parquet_df with the concatenated, limited dataframe.</p></li>
</ul>
</div></blockquote>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Assumes self.parquet_df is a Polars DataFrame.</p></li>
<li><p>Uses NumPy to determine unique class labels.</p></li>
</ul>
</div>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.over_sample_minority_classes">
<span class="sig-name descname"><span class="pre">over_sample_minority_classes</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.over_sample_minority_classes" title="Link to this definition"></a></dt>
<dd><p>Oversamples the minority classes in the dataset contained in self.parquet_df.
This method identifies the class with the maximum sample count and for every other class, performs
sampling with replacement so that each class has the same number of samples as the majority class.
The oversampled dataframes for the minority classes are concatenated and reassigned to self.parquet_df.</p>
<dl class="simple">
<dt>Side Effects:</dt><dd><ul class="simple">
<li><p>Modifies self.parquet_df by oversampling minority classes.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.BTS_LC_Dataset.print_dataset_composition">
<span class="sig-name descname"><span class="pre">print_dataset_composition</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.BTS_LC_Dataset.print_dataset_composition" title="Link to this definition"></a></dt>
<dd><p>Prints a summary of the dataset composition before any transformations or mappings are applied.
This method extracts the unique classes and their respective counts from the ‘bts_class’
column of the dataframe stored in self.parquet_df, constructs a dictionary with this information,
and then prints it as a formatted table.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.custom_collate_BTS">
<span class="sig-prename descclassname"><span class="pre">oracle.custom_datasets.BTS.</span></span><span class="sig-name descname"><span class="pre">custom_collate_BTS</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.custom_collate_BTS" title="Link to this definition"></a></dt>
<dd><p>Collate function for batching BTS dataset samples.
This function takes a list of sample dictionaries and collates them into a single batch
dictionary suitable for training or inference. It pads the time-series data, concatenates
static and meta features, and properly stacks optional image data (postage_stamp and lc_plot)
if they are present in the sample dictionaries.
:param batch: A list where each element is a dictionary containing the following keys:</p>
<blockquote>
<div><dl class="simple">
<dt>Required keys:</dt><dd><ul class="simple">
<li><p>‘ts’ (numpy.ndarray): Time-series data for the sample.</p></li>
<li><p>‘label’: Label corresponding to the sample.</p></li>
<li><p>‘ZTFID’: Identifier for the sample.</p></li>
<li><p>‘bts_class’: Raw label or class of the sample.</p></li>
<li><p>‘meta’ (numpy.ndarray): Meta features array from which the last row is used.</p></li>
<li><p>‘static’ (numpy.ndarray): Static features for the sample.</p></li>
</ul>
</dd>
<dt>Optional keys:</dt><dd><ul class="simple">
<li><p>‘postage_stamp’: Tensor representing the postage stamp image.</p></li>
<li><p>‘lc_plot’: Tensor representing the light curve plot image.</p></li>
</ul>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><dl class="simple">
<dt>A dictionary with the following entries:</dt><dd><ul class="simple">
<li><p>’ts’ (Tensor): Padded time-series data tensor with shape (batch_size, max_seq_length, …).</p></li>
<li><p>’static’ (Tensor): Concatenated tensor of static and meta features.</p></li>
<li><p>’length’ (Tensor): Tensor containing the original lengths of each time-series sample.</p></li>
<li><p>’label’ (numpy.ndarray): Array of sample labels.</p></li>
<li><p>’raw_label’ (numpy.ndarray): Array of BTS raw labels.</p></li>
<li><p>’id’ (numpy.ndarray): Array of sample identifiers.</p></li>
<li><p>’postage_stamp’ (Tensor, optional): Stacked tensor of postage stamp images, if available.</p></li>
<li><p>’lc_plot’ (Tensor, optional): Stacked tensor of light curve plot images, if available.</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.show_batch">
<span class="sig-prename descclassname"><span class="pre">oracle.custom_datasets.BTS.</span></span><span class="sig-name descname"><span class="pre">show_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">16</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.show_batch" title="Link to this definition"></a></dt>
<dd><p>Display a grid of images with corresponding labels.
This function creates a visual representation of the first n images from the provided dataset.
It arranges the images in a square grid and annotates each image with its corresponding label.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>images</strong> (<em>Tensor</em><em> or </em><em>array-like</em>) – Collection of images to be displayed. Each image is expected to have the shape
(C, H, W), where C is the number of channels. For grayscale images, C should be 1.</p></li>
<li><p><strong>labels</strong> (<em>Sequence</em>) – Sequence of labels corresponding to each image.</p></li>
<li><p><strong>n</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of images to display. The function uses the first n images from the collection.
Defaults to 16.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Displays:</dt><dd><p>A matplotlib figure containing a grid of images, each annotated with its respective label.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oracle.custom_datasets.BTS.truncate_BTS_light_curve_by_days_since_trigger">
<span class="sig-prename descclassname"><span class="pre">oracle.custom_datasets.BTS.</span></span><span class="sig-name descname"><span class="pre">truncate_BTS_light_curve_by_days_since_trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">x_static</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">add_jitter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize_flux</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.BTS.truncate_BTS_light_curve_by_days_since_trigger" title="Link to this definition"></a></dt>
<dd><p>Truncate the BTS light curve based on the number of days since the first trigger.
This function selects observations from the time-series data (x_ts) that occur within a specified number of days (d) from the first detection (trigger).
It also optionally adds jitter to the flux measurements and normalizes the flux values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_ts</strong> (<em>numpy.ndarray</em>) – <p>Time-dependent features array where each row represents an observation.
Expected to contain the following features:</p>
<blockquote>
<div><ul>
<li><p>’jd’: Julian date of the observation.</p></li>
<li><p>’magpsf’: magnitude.</p></li>
<li><p>’sigmapsf’: Uncertainty of the magnitude.</p></li>
<li><p>’fid’: Filter identifier.</p></li>
<li><p>’photflag’: Photometric flag (added as an extra column to maintain compatibility with ZTF sims and always assumed to be 1).</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>x_static</strong> (<em>numpy.ndarray</em>) – Corresponding static features array for each observation.</p></li>
<li><p><strong>d</strong> (<em>float</em><em>, </em><em>optional</em>) – Maximum number of days from the trigger within which to keep observations.
If None, a random threshold is generated using 2^(uniform(0, 11)).</p></li>
<li><p><strong>add_jitter</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, adds Gaussian noise to the flux by using flux error as 1 sigma values.</p></li>
<li><p><strong>normalize_flux</strong> (<em>bool</em><em>, </em><em>optional</em>) – If True, normalizes the flux (‘magpsf’) using its mean and standard deviation.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><dl class="simple">
<dt>A tuple containing:</dt><dd><ul class="simple">
<li><p>x_ts (numpy.ndarray): The truncated time-dependent features array.</p></li>
<li><p>x_static (numpy.ndarray): The static features array.</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>The function assumes that the dataset does not contain any non-detections.</p></li>
</ul>
</div>
</dd></dl>

</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Ved Shah.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>