

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>oracle.custom_datasets.ZTF_sims module &mdash; oracle 1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=29a6c3e3"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            oracle
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">oracle</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">oracle.custom_datasets.ZTF_sims module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/source/oracle.custom_datasets.ZTF_sims.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-oracle.custom_datasets.ZTF_sims">
<span id="oracle-custom-datasets-ztf-sims-module"></span><h1>oracle.custom_datasets.ZTF_sims module<a class="headerlink" href="#module-oracle.custom_datasets.ZTF_sims" title="Link to this heading"></a></h1>
<dl class="py class">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset">
<em class="property"><span class="k"><span class="pre">class</span></span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">oracle.custom_datasets.ZTF_sims.</span></span><span class="sig-name descname"><span class="pre">ZTF_SIM_LC_Dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">parquet_file_path</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_n_per_class</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_lc_plots</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">transform</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Dataset</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.clean_up_dataset">
<span class="sig-name descname"><span class="pre">clean_up_dataset</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.clean_up_dataset" title="Link to this definition"></a></dt>
<dd><p>Cleans and transforms the dataset stored in the object’s parquet_df attribute.
This method performs several dataset cleaning operations including:
- Replacing band labels in the “FLT” column with their corresponding mean wavelengths</p>
<blockquote>
<div><p>using the mapping defined in ZTF_passband_to_wavelengths.</p>
</div></blockquote>
<ul class="simple">
<li><dl class="simple">
<dt>Removing saturated measurements from time series features:</dt><dd><ul>
<li><p>For each time-dependent feature, it removes data points where the
corresponding “PHOTFLAG” bitmask indicates saturation (using bitwise logic with 1024).</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Replacing the “PHOTFLAG” bitmask values:</dt><dd><ul>
<li><p>Converts the cleaned “PHOTFLAG” list to binary flags where any instance of the flag 4096
is set to 1 (indicating detection) and 0 otherwise.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Adjusting the time series:</dt><dd><ul>
<li><p>Normalizes the “MJD_clean” column by subtracting the time of the first observation from all entries.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Mapping simulation class labels:</dt><dd><ul>
<li><p>Replaces ZTF simulation classes with astrophysical class labels using ZTF_sims_to_Astrophysical_mappings.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>Handling missing data in time-independent features:</dt><dd><ul>
<li><p>Replaces any feature value that matches a missing data flag with a specified flag_value.</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<p>The method updates the parquet_df in place and prints progress messages for each step.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.get_all_labels">
<span class="sig-name descname"><span class="pre">get_all_labels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.get_all_labels" title="Link to this definition"></a></dt>
<dd><p>Retrieve all labels from the dataset.</p>
<p>This method extracts the ‘class’ column from the parquet dataframe attribute and
returns it as a list.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A list containing all labels present in the ‘class’ column.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.get_lc_plots">
<span class="sig-name descname"><span class="pre">get_lc_plots</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_ts</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.get_lc_plots" title="Link to this definition"></a></dt>
<dd><p>Generates a light curve plot from the provided time series data and returns it as a PyTorch tensor.</p>
<dl class="simple">
<dt>The function performs the following steps:</dt><dd><ul class="simple">
<li><p>Extracts light curve parameters such as Julian dates, flux measurements, flux errors, filter identifiers, and photometric flags from the input array.</p></li>
<li><p>For each wavelength (as defined in ‘ZTF_wavelength_to_color’), it plots:</p></li>
<li><p>Detected data points using the ‘marker_style_detection’.</p></li>
<li><p>Non-detected data points using the ‘marker_style_non_detection’. Both with error bars corresponding to flux uncertainties.</p></li>
<li><p>Overlays a line plot connecting all points for each wavelength.</p></li>
<li><p>Configures the matplotlib figure by setting a fixed size, removing axis ticks and all spines.</p></li>
<li><p>Saves the plot into an in-memory PNG buffer at a specified DPI, then loads it via PIL.</p></li>
<li><p>Converts the image to a NumPy array, permutes the dimensions, and finally converts it into a PyTorch tensor.</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x_ts</strong> (<em>np.ndarray</em>) – A 2D NumPy array representing the time series data.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A tensor representation of the generated light curve plot image.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.limit_max_samples_per_class">
<span class="sig-name descname"><span class="pre">limit_max_samples_per_class</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.limit_max_samples_per_class" title="Link to this definition"></a></dt>
<dd><p>Limits the number of samples per class in the dataset.</p>
<p>For every unique class in the ‘class’ column of self.parquet_df, this method selects
at most self.max_n_per_class entries (i.e., the first self.max_n_per_class samples) and
concatenates them into a new dataframe that replaces self.parquet_df.</p>
<dl class="simple">
<dt>Informative messages are printed to indicate:</dt><dd><ul class="simple">
<li><p>The overall limit being applied per class.</p></li>
<li><p>The resulting number of samples retained for each class.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.print_dataset_composition">
<span class="sig-name descname"><span class="pre">print_dataset_composition</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.ZTF_SIM_LC_Dataset.print_dataset_composition" title="Link to this definition"></a></dt>
<dd><p>Prints the composition of the dataset. It formats these values into
a pandas DataFrame and prints the resulting table to the console.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>None</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.custom_collate_ZTF_SIM">
<span class="sig-prename descclassname"><span class="pre">oracle.custom_datasets.ZTF_sims.</span></span><span class="sig-name descname"><span class="pre">custom_collate_ZTF_SIM</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.custom_collate_ZTF_SIM" title="Link to this definition"></a></dt>
<dd><p>Collates a batch of ZTF simulation samples into a single dictionary of tensors suitable for model input.</p>
<dl class="simple">
<dt>Each sample in the input batch is expected to be a dictionary with the following keys:</dt><dd><ul class="simple">
<li><p>‘ts’: A tensor representing the time series data. The tensor should have shape (num_time_points, …).</p></li>
<li><p>‘label’: The label associated with the sample (e.g., class index or regression target).</p></li>
<li><p>‘SNID’: A unique identifier for the sample.</p></li>
<li><p>‘static’: A tensor of static features with a predefined number of features (n_static_features).</p></li>
<li><p>‘lc_plot’: (Optional) A tensor representing the light curve plot image with shape (n_channels, img_height, img_width).</p></li>
</ul>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>batch</strong> (<em>list</em>) – A list of sample dictionaries as described above.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A dictionary containing the collated batch with the same keys as the input samples, where:</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.show_batch">
<span class="sig-prename descclassname"><span class="pre">oracle.custom_datasets.ZTF_sims.</span></span><span class="sig-name descname"><span class="pre">show_batch</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">16</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.show_batch" title="Link to this definition"></a></dt>
<dd><p>Display a grid of images with corresponding labels.
This function creates a visual representation of the first n images from the provided dataset.
It arranges the images in a square grid and annotates each image with its corresponding label.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>images</strong> (<em>Tensor</em><em> or </em><em>array-like</em>) – Collection of images to be displayed. Each image is expected to have the shape
(C, H, W), where C is the number of channels. For grayscale images, C should be 1.</p></li>
<li><p><strong>labels</strong> (<em>Sequence</em>) – Sequence of labels corresponding to each image.</p></li>
<li><p><strong>n</strong> (<em>int</em><em>, </em><em>optional</em>) – The number of images to display. The function uses the first n images from the collection.
Defaults to 16.</p></li>
</ul>
</dd>
</dl>
<dl class="simple">
<dt>Displays:</dt><dd><p>A matplotlib figure containing a grid of images, each annotated with its respective label.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.truncate_ZTF_SIM_light_curve_by_days_since_trigger">
<span class="sig-prename descclassname"><span class="pre">oracle.custom_datasets.ZTF_sims.</span></span><span class="sig-name descname"><span class="pre">truncate_ZTF_SIM_light_curve_by_days_since_trigger</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">d</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.truncate_ZTF_SIM_light_curve_by_days_since_trigger" title="Link to this definition"></a></dt>
<dd><p>Truncates a ZTF SIM light curve by retaining only the observations within a specified number of days since the trigger (first detection).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_ts</strong> (<em>numpy.ndarray</em>) – A 2D array representing the time series data of the light curve. It is expected to have columns corresponding
to various features, including ‘PHOTFLAG’ and ‘MJD’, as specified in the global list ‘time_dependent_feature_list’.</p></li>
<li><p><strong>d</strong> (<em>float</em>) – The time window (in days) from the first detection. Observations beyond this period are removed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The truncated light curve array containing only the observations within the specified days since the trigger.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="oracle.custom_datasets.ZTF_sims.truncate_ZTF_SIM_light_curve_fractionally">
<span class="sig-prename descclassname"><span class="pre">oracle.custom_datasets.ZTF_sims.</span></span><span class="sig-name descname"><span class="pre">truncate_ZTF_SIM_light_curve_fractionally</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x_ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#oracle.custom_datasets.ZTF_sims.truncate_ZTF_SIM_light_curve_fractionally" title="Link to this definition"></a></dt>
<dd><p>Truncate a ZTF simulation light curve by retaining only a fraction of its observations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x_ts</strong> (<em>numpy.ndarray</em>) – A 2D array representing the light curve where each row corresponds to an observation.</p></li>
<li><p><strong>f</strong> (<em>float</em><em>, </em><em>optional</em>) – Fraction of the total observations to retain. If not provided (None),
a random fraction between 0.1 and 1.0 will be used.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A truncated version of the input light curve containing a fraction (at least one) of the original observations.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>numpy.ndarray</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Ved Shah.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>